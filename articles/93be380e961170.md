---
title: "「この画面を開くと、最初の画面に戻っちゃうんです」に対応した時の記録"
emoji: "👏"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['kotlin', 'gcp', '障害']
published: false
---

##  この記事は
ある日、タイトルのような事象が発生し、いろいろ調べていくうちに勉強になったので書き記しておこうと思います。

## 事象

## 原因
概ね以下のようなことが発生していました。

1. ユーザーはユーザー一覧ページを開く
2. ユーザー一覧ページでは1行ごとにリクエストが発行される（!）。概ね200リクエストくらい
3. 一部のリクエストのうち、401エラーが発生
4. サーバは認証されていないと判断し、`/login`を試行
5. ただし、実際は認証されているため、`/top`へ遷移する

### 1行ごとにリクエストがされる

### なぜ401になる原因
1行ごとにリクエストが発生するのは簡単に発見できたのですが、それらのうち一部のリクエストだけが401になる理由がわかりませんでした。

## 解消方法
ほぼわかると思いますが、1行ごとに実行していたリクエストをユーザー一覧取得のSQLに含めるようにしました。

## まとめ

